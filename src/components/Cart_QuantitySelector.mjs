// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Curry from "rescript/lib/es6/curry.js";
import * as React from "react";
import * as Js_json from "rescript/lib/es6/js_json.js";
import * as IconError from "./svgs/IconError.mjs";
import * as Belt_Option from "rescript/lib/es6/belt_Option.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as ReactEvents from "../utils/ReactEvents.mjs";
import * as ReactRelay from "react-relay";
import * as ReactHookForm from "../bindings/ReactHookForm/ReactHookForm.mjs";
import * as RelayRuntime from "relay-runtime";
import * as Cart_Buyer_Form from "./Cart_Buyer_Form.mjs";
import * as ReactHookForm$1 from "react-hook-form";
import * as ReactToastNotifications from "react-toast-notifications";
import PlusSvg from "../../public/assets/plus.svg";
import MinusSvg from "../../public/assets/minus.svg";
import * as CartQuantitySelectorMutation_graphql from "../__generated__/CartQuantitySelectorMutation_graphql.mjs";

function commitMutation(environment, variables, optimisticUpdater, optimisticResponse, updater, onCompleted, onError, uploadables, param) {
  return RelayRuntime.commitMutation(environment, {
              mutation: CartQuantitySelectorMutation_graphql.node,
              variables: CartQuantitySelectorMutation_graphql.Internal.convertVariables(variables),
              onCompleted: (function (res, err) {
                  if (onCompleted !== undefined) {
                    return Curry._2(onCompleted, CartQuantitySelectorMutation_graphql.Internal.convertResponse(res), (err == null) ? undefined : Caml_option.some(err));
                  }
                  
                }),
              onError: (function (err) {
                  if (onError !== undefined) {
                    return Curry._1(onError, (err == null) ? undefined : Caml_option.some(err));
                  }
                  
                }),
              optimisticResponse: optimisticResponse !== undefined ? CartQuantitySelectorMutation_graphql.Internal.convertWrapRawResponse(optimisticResponse) : undefined,
              optimisticUpdater: optimisticUpdater,
              updater: updater !== undefined ? (function (store, r) {
                    Curry._2(updater, store, CartQuantitySelectorMutation_graphql.Internal.convertResponse(r));
                  }) : undefined,
              uploadables: uploadables
            });
}

function use(param) {
  var match = ReactRelay.useMutation(CartQuantitySelectorMutation_graphql.node);
  var mutate = match[0];
  return [
          React.useMemo((function () {
                  return function (param, param$1, param$2, param$3, param$4, param$5, param$6, param$7, param$8) {
                    return Curry._1(mutate, {
                                onError: param,
                                onCompleted: param$1 !== undefined ? (function (r, errors) {
                                      Curry._2(param$1, CartQuantitySelectorMutation_graphql.Internal.convertResponse(r), (errors == null) ? undefined : Caml_option.some(errors));
                                    }) : undefined,
                                onUnsubscribe: param$2,
                                optimisticResponse: param$3 !== undefined ? CartQuantitySelectorMutation_graphql.Internal.convertWrapRawResponse(param$3) : undefined,
                                optimisticUpdater: param$4,
                                updater: param$5 !== undefined ? (function (store, r) {
                                      Curry._2(param$5, store, CartQuantitySelectorMutation_graphql.Internal.convertResponse(r));
                                    }) : undefined,
                                variables: CartQuantitySelectorMutation_graphql.Internal.convertVariables(param$6),
                                uploadables: param$7
                              });
                  };
                }), [mutate]),
          match[1]
        ];
}

var Mutation = {
  Operation: undefined,
  Types: undefined,
  commitMutation: commitMutation,
  use: use
};

var minusIcon = MinusSvg;

var plusIcon = PlusSvg;

function Cart_QuantitySelector(props) {
  var cartId = props.cartId;
  var match = ReactToastNotifications.useToasts();
  var addToast = match.addToast;
  var match$1 = ReactHookForm$1.useFormContext({
        mode: "onChange"
      }, undefined);
  var handleError = function (message, param) {
    addToast(React.createElement("div", {
              className: "flex items-center w-full whitespace-pre-wrap"
            }, React.createElement(IconError.make, {
                  width: "24",
                  height: "24",
                  className: "mr-2"
                }), "상품 수량 수정에 실패하였습니다. " + Belt_Option.getWithDefault(message, "") + ""), {
          appearance: "error"
        });
  };
  var match$2 = use(undefined);
  var mutate = match$2[0];
  var formNames = Cart_Buyer_Form.names(props.prefix);
  var handleChange = function (changeFn, fn, v) {
    return function (param) {
      return ReactEvents.interceptingHandler((function (param) {
                    Belt_Option.forEach(Belt_Option.map(Js_json.decodeNumber(v), (function (prim) {
                                return prim | 0;
                              })), (function (v$p) {
                            var match = Curry._2(fn, v$p, 1);
                            if (match !== 0 && match !== 1000) {
                              Curry.app(mutate, [
                                    (function (err) {
                                        handleError(err.message, undefined);
                                      }),
                                    (function (param, param$1) {
                                        var updateCartItemQuantity = param.updateCartItemQuantity;
                                        if (typeof updateCartItemQuantity !== "object") {
                                          return handleError(undefined, undefined);
                                        }
                                        var variant = updateCartItemQuantity.NAME;
                                        if (variant === "UpdateCartItemQuantitySuccess") {
                                          return Curry._1(changeFn, Curry._1(ReactHookForm.Controller.OnChangeArg.value, Curry._2(fn, v$p, 1)));
                                        } else if (variant === "Error") {
                                          return handleError(Belt_Option.getWithDefault(updateCartItemQuantity.VAL.message, ""), undefined);
                                        } else {
                                          return handleError(undefined, undefined);
                                        }
                                      }),
                                    undefined,
                                    undefined,
                                    undefined,
                                    undefined,
                                    {
                                      cartId: cartId,
                                      quantity: Curry._2(fn, v$p, 1)
                                    },
                                    undefined,
                                    undefined
                                  ]);
                              return ;
                            }
                            
                          }));
                  }), param);
    };
  };
  var plus = function (x, y) {
    return x + y | 0;
  };
  var minus = function (x, y) {
    return x - y | 0;
  };
  return React.createElement(ReactHookForm$1.Controller, {
              name: formNames.quantity,
              control: Caml_option.some(match$1.control),
              render: (function (param) {
                  var match = param.field;
                  var value = match.value;
                  var onChange = match.onChange;
                  return React.createElement("div", {
                              className: "w-24 flex justify-between py-[7px] px-[11px] gap-[11px] bg-white rounded-lg border border-gray-250"
                            }, React.createElement("button", {
                                  onClick: handleChange(onChange, minus, value)
                                }, React.createElement("img", {
                                      className: "w-4 h-4 cursor-pointer",
                                      alt: "minus-icon",
                                      src: minusIcon
                                    })), JSON.stringify(value), React.createElement("button", {
                                  onClick: handleChange(onChange, plus, value)
                                }, React.createElement("img", {
                                      className: "w-4 h-4 cursor-pointer",
                                      alt: "plus-icon",
                                      src: plusIcon
                                    })));
                }),
              defaultValue: Caml_option.some(props.quantity)
            });
}

var Form;

var make = Cart_QuantitySelector;

export {
  Mutation ,
  Form ,
  minusIcon ,
  plusIcon ,
  make ,
}
/* minusIcon Not a pure module */
