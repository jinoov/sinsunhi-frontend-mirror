// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Curry from "rescript/lib/es6/curry.js";
import * as React from "react";
import * as Dialog from "./common/Dialog.mjs";
import * as Belt_Option from "rescript/lib/es6/belt_Option.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Garter_Array from "@greenlabs/garter/src/Garter_Array.mjs";
import * as IconCloseInput from "./svgs/IconCloseInput.mjs";
import * as UploadFileToS3PresignedUrl from "../utils/UploadFileToS3PresignedUrl.mjs";

function Upload_Orders_Admin(Props) {
  var userId = Props.userId;
  var onSuccess = Props.onSuccess;
  var onFailure = Props.onFailure;
  var match = React.useState(function () {
        
      });
  var setFiles = match[1];
  var file = Belt_Option.flatMap(match[0], Garter_Array.first);
  var match$1 = React.useState(function () {
        return /* Hide */1;
      });
  var setShowDelete = match$1[1];
  var match$2 = React.useState(function () {
        return /* Hide */1;
      });
  var setShowRequired = match$2[1];
  var match$3 = React.useState(function () {
        return /* Hide */1;
      });
  var setShowUserRequired = match$3[1];
  var match$4 = React.useState(function () {
        return /* Hide */1;
      });
  var setShowFileRequired = match$4[1];
  var isUserSelected = Belt_Option.isSome(userId);
  var handleOnChangeFiles = function (e) {
    var values = e.target.files;
    setFiles(function (param) {
          return values;
        });
    if (userId !== undefined) {
      return ;
    } else {
      return setShowUserRequired(function (param) {
                  return /* Show */0;
                });
    }
  };
  var handleResetFile = function (param) {
    var inputFile = document.getElementById("input-file");
    Belt_Option.map((inputFile == null) ? undefined : Caml_option.some(inputFile), (function (inputFile$p) {
            inputFile$p.value = "";
            
          }));
    return setFiles(function (param) {
                
              });
  };
  return React.createElement(React.Fragment, undefined, React.createElement("section", undefined, React.createElement("div", {
                      className: "flex justify-between"
                    }, React.createElement("div", undefined, React.createElement("h3", {
                              className: "text-lg font-bold"
                            }, "2. 주문서 선택"), React.createElement("span", {
                              className: "block text-gray-400 text-sm"
                            }, "*.xls, xlsx 확장자만 업로드 가능")), React.createElement("label", {
                          className: isUserSelected ? "p-3 w-28 text-white text-center font-bold bg-green-gl rounded-xl cursor-pointer focus:outline-none hover:bg-green-gl-dark whitespace-nowrap focus-within:bg-green-gl-dark focus-within:outline-none" : "p-3 w-28 text-white text-center font-bold bg-gray-300 rounded-xl focus:outline-none whitespace-nowrap"
                        }, React.createElement("span", undefined, "파일 선택"), React.createElement("input", {
                              className: "sr-only",
                              id: "input-file",
                              accept: ".xls,.xlsx",
                              disabled: !isUserSelected,
                              type: "file",
                              onChange: handleOnChangeFiles
                            }))), React.createElement("div", {
                      className: file !== undefined ? "p-3 relative w-full flex items-center rounded-xl mt-4 border border-gray-200 text-gray-400" : "p-3 relative w-full flex items-center rounded-xl mt-4 border border-gray-200 text-gray-400 bg-gray-100"
                    }, React.createElement("span", undefined, Belt_Option.getWithDefault(Belt_Option.map(file, (function (file$p) {
                                    return file$p.name;
                                  })), "파일명.xlsx")), Belt_Option.getWithDefault(Belt_Option.map(file, (function (param) {
                                return React.createElement("span", {
                                            className: "absolute p-2 right-0",
                                            onClick: (function (param) {
                                                return setShowDelete(function (param) {
                                                            return /* Show */0;
                                                          });
                                              })
                                          }, React.createElement(IconCloseInput.make, {
                                                height: "28",
                                                width: "28",
                                                fill: "#B2B2B2"
                                              }));
                              })), null))), React.createElement("section", {
                  className: "mt-10"
                }, React.createElement("div", {
                      className: "flex justify-between items-center"
                    }, React.createElement("div", {
                          className: "flex-1 flex justify-between"
                        }, React.createElement("h3", {
                              className: "font-bold text-lg"
                            }, "3. 주문서 업로드"), React.createElement("button", {
                              className: Belt_Option.isSome(file) ? "text-white font-bold p-3 w-28 bg-green-gl rounded-xl focus:outline-none hover:bg-green-gl-dark" : "text-white font-bold p-3 w-28 bg-gray-300 rounded-xl focus:outline-none",
                              disabled: Belt_Option.isNone(file),
                              onClick: (function (param) {
                                  if (userId !== undefined) {
                                    if (file !== undefined) {
                                      UploadFileToS3PresignedUrl.upload(userId, /* Buyer */1, Caml_option.valFromOption(file), (function (param) {
                                              handleResetFile(undefined);
                                              return Curry._1(onSuccess, undefined);
                                            }), (function (param) {
                                              return Curry._1(onFailure, undefined);
                                            }), undefined);
                                      return ;
                                    } else {
                                      return setShowUserRequired(function (param) {
                                                  return /* Show */0;
                                                });
                                    }
                                  } else if (file !== undefined) {
                                    return setShowFileRequired(function (param) {
                                                return /* Show */0;
                                              });
                                  } else {
                                    return setShowRequired(function (param) {
                                                return /* Show */0;
                                              });
                                  }
                                })
                            }, "업로드")))), React.createElement(Dialog.make, {
                  isShow: match$2[0],
                  children: React.createElement("p", {
                        className: "text-gray-500 text-center whitespace-pre-wrap"
                      }, "바이어와 파일을 먼저 선택해주세요."),
                  onConfirm: (function (param) {
                      return setShowRequired(function (param) {
                                  return /* Hide */1;
                                });
                    })
                }), React.createElement(Dialog.make, {
                  isShow: match$3[0],
                  children: React.createElement("p", {
                        className: "text-gray-500 text-center whitespace-pre-wrap"
                      }, "바이어를 먼저 선택해주세요."),
                  onConfirm: (function (param) {
                      return setShowUserRequired(function (param) {
                                  return /* Hide */1;
                                });
                    })
                }), React.createElement(Dialog.make, {
                  isShow: match$4[0],
                  children: React.createElement("p", {
                        className: "text-gray-500 text-center whitespace-pre-wrap"
                      }, "파일을 선택해주세요."),
                  onConfirm: (function (param) {
                      return setShowFileRequired(function (param) {
                                  return /* Hide */1;
                                });
                    })
                }), React.createElement(Dialog.make, {
                  isShow: match$1[0],
                  children: React.createElement("p", {
                        className: "text-gray-500 text-center whitespace-pre-wrap"
                      }, "파일을 삭제하시겠어요?"),
                  onCancel: (function (param) {
                      return setShowDelete(function (param) {
                                  return /* Hide */1;
                                });
                    }),
                  onConfirm: (function (param) {
                      handleResetFile(undefined);
                      return setShowDelete(function (param) {
                                  return /* Hide */1;
                                });
                    }),
                  textOnCancel: "닫기",
                  textOnConfirm: "삭제"
                }));
}

var make = Upload_Orders_Admin;

export {
  make ,
  
}
/* react Not a pure module */
