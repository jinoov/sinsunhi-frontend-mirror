// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Curry from "rescript/lib/es6/curry.js";
import * as React from "react";
import * as Dialog from "./common/Dialog.mjs";
import * as Js_dict from "rescript/lib/es6/js_dict.js";
import * as Belt_Option from "rescript/lib/es6/belt_Option.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Router from "next/router";
import * as Garter_Array from "@greenlabs/garter/src/Garter_Array.mjs";
import * as IconCloseInput from "./svgs/IconCloseInput.mjs";
import * as UploadFileToS3PresignedUrl from "../utils/UploadFileToS3PresignedUrl.mjs";

function Upload_Delivery_Admin(Props) {
  var onSuccess = Props.onSuccess;
  var onFailure = Props.onFailure;
  var router = Router.useRouter();
  var match = React.useState(function () {
        
      });
  var setFiles = match[1];
  var file = Belt_Option.flatMap(match[0], Garter_Array.first);
  var match$1 = React.useState(function () {
        return /* Hide */1;
      });
  var setShowDelete = match$1[1];
  var match$2 = React.useState(function () {
        return /* Hide */1;
      });
  var setShowFileRequired = match$2[1];
  var handleOnChangeFiles = function (e) {
    var values = e.target.files;
    return setFiles(function (param) {
                return values;
              });
  };
  var handleResetFile = function (param) {
    var inputFile = document.getElementById("input-file");
    Belt_Option.map((inputFile == null) ? undefined : Caml_option.some(inputFile), (function (inputFile$p) {
            inputFile$p.value = "";
            
          }));
    return setFiles(function (param) {
                
              });
  };
  return React.createElement(React.Fragment, undefined, React.createElement("section", {
                  className: "flex-1 px-4"
                }, React.createElement("div", {
                      className: "flex justify-between"
                    }, React.createElement("div", undefined, React.createElement("h4", {
                              className: "font-semibold"
                            }, "2. 주문서 선택"), React.createElement("span", {
                              className: "block text-gray-400 text-sm"
                            }, "*.xls, xlsx 확장자만 업로드 가능")), React.createElement("label", {
                          className: "p-3 text-white text-center font-bold bg-green-gl rounded-xl cursor-pointer focus:outline-none hover:bg-green-gl-dark whitespace-nowrap focus-within:bg-green-gl-dark focus-within:outline-none"
                        }, React.createElement("span", undefined, "파일 선택"), React.createElement("input", {
                              className: "sr-only",
                              id: "input-file",
                              accept: ".xls,.xlsx",
                              type: "file",
                              onChange: handleOnChangeFiles
                            })))), React.createElement("section", {
                  className: "flex-1 pl-4"
                }, React.createElement("div", {
                      className: "flex justify-between"
                    }, React.createElement("div", {
                          className: "flex-auto mr-2"
                        }, React.createElement("h4", {
                              className: "font-semibold"
                            }, "3. 주문서 업로드"), React.createElement("div", {
                              className: "relative w-full flex items-center mt-1 text-gray-400 text-sm"
                            }, React.createElement("span", undefined, Belt_Option.getWithDefault(Belt_Option.map(file, (function (file$p) {
                                            return file$p.name;
                                          })), "파일명.xlsx")), Belt_Option.getWithDefault(Belt_Option.map(file, (function (param) {
                                        return React.createElement("span", {
                                                    className: "absolute p-2 right-0",
                                                    onClick: (function (param) {
                                                        return setShowDelete(function (param) {
                                                                    return /* Show */0;
                                                                  });
                                                      })
                                                  }, React.createElement(IconCloseInput.make, {
                                                        height: "28",
                                                        width: "28",
                                                        fill: "#B2B2B2"
                                                      }));
                                      })), null))), React.createElement("button", {
                          className: Belt_Option.isSome(file) ? "text-white font-bold p-3 h-12 bg-green-gl rounded-xl focus:outline-none hover:bg-green-gl-dark whitespace-nowrap" : "text-white font-bold p-3 h-12 bg-gray-300 rounded-xl focus:outline-none whitespace-normal",
                          disabled: Belt_Option.isNone(file),
                          onClick: (function (param) {
                              var userId = Js_dict.get(router.query, "farmer-id");
                              if (file !== undefined) {
                                UploadFileToS3PresignedUrl.upload(userId, /* Seller */0, Caml_option.valFromOption(file), (function (param) {
                                        handleResetFile(undefined);
                                        return Curry._1(onSuccess, undefined);
                                      }), (function (param) {
                                        return Curry._1(onFailure, undefined);
                                      }), undefined);
                                return ;
                              } else {
                                return setShowFileRequired(function (param) {
                                            return /* Show */0;
                                          });
                              }
                            })
                        }, "업로드"))), React.createElement(Dialog.make, {
                  isShow: match$2[0],
                  children: React.createElement("p", {
                        className: "text-gray-500 text-center whitespace-pre-wrap"
                      }, "파일을 선택해주세요."),
                  onConfirm: (function (param) {
                      return setShowFileRequired(function (param) {
                                  return /* Hide */1;
                                });
                    })
                }), React.createElement(Dialog.make, {
                  isShow: match$1[0],
                  children: React.createElement("p", {
                        className: "text-gray-500 text-center whitespace-pre-wrap"
                      }, "파일을 삭제하시겠어요?"),
                  onCancel: (function (param) {
                      return setShowDelete(function (param) {
                                  return /* Hide */1;
                                });
                    }),
                  onConfirm: (function (param) {
                      handleResetFile(undefined);
                      return setShowDelete(function (param) {
                                  return /* Hide */1;
                                });
                    }),
                  textOnCancel: "닫기",
                  textOnConfirm: "삭제"
                }));
}

var make = Upload_Delivery_Admin;

export {
  make ,
  
}
/* react Not a pure module */
