// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Curry from "rescript/lib/es6/curry.js";
import * as React from "@rescript/react/src/React.mjs";
import * as React$1 from "react";
import * as Locale from "../../../../utils/Locale.mjs";
import * as Echarts from "../../../../bindings/Echarts.mjs";
import Link from "next/link";
import * as Belt_Array from "rescript/lib/es6/belt_Array.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as CustomHooks from "../../../../utils/CustomHooks.mjs";
import * as Router from "next/router";
import ReactNl2br from "react-nl2br";
import * as ReactRelay from "react-relay";
import * as Product_Parser from "../../../../utils/Product_Parser.mjs";
import * as Js_null_undefined from "rescript/lib/es6/js_null_undefined.js";
import * as RescriptRelay_Internal from "rescript-relay/src/RescriptRelay_Internal.mjs";
import * as PDPMatchingDemeterBuyer_fragment_graphql from "../../../../__generated__/PDPMatchingDemeterBuyer_fragment_graphql.mjs";
import DemeterChartPlaceholderSvg from "../../../../../public/assets/demeter-chart-placeholder.svg";

var placeholderIcon = DemeterChartPlaceholderSvg;

function use(fRef) {
  var data = ReactRelay.useFragment(PDPMatchingDemeterBuyer_fragment_graphql.node, fRef);
  return RescriptRelay_Internal.internal_useConvertedValue(PDPMatchingDemeterBuyer_fragment_graphql.Internal.convertFragment, data);
}

function useOpt(opt_fRef) {
  var fr = opt_fRef !== undefined ? Caml_option.some(Caml_option.valFromOption(opt_fRef)) : undefined;
  var nullableFragmentData = ReactRelay.useFragment(PDPMatchingDemeterBuyer_fragment_graphql.node, fr !== undefined ? Js_null_undefined.fromOption(Caml_option.some(Caml_option.valFromOption(fr))) : null);
  var data = (nullableFragmentData == null) ? undefined : Caml_option.some(nullableFragmentData);
  return RescriptRelay_Internal.internal_useConvertedValue((function (rawFragment) {
                if (rawFragment !== undefined) {
                  return PDPMatchingDemeterBuyer_fragment_graphql.Internal.convertFragment(rawFragment);
                }
                
              }), data);
}

var Fragment = {
  Types: undefined,
  Operation: undefined,
  use: use,
  useOpt: useOpt
};

function use$1(query) {
  var match = use(query);
  var weeklyMarketPrices = match.weeklyMarketPrices;
  if (weeklyMarketPrices === undefined) {
    return ;
  }
  var representativeWeight = match.representativeWeight;
  return Curry._3(Product_Parser.Matching.Chart.Group.make, Curry._2(Product_Parser.Matching.Chart.Payload.make, Belt_Array.map(weeklyMarketPrices.high, (function (param) {
                        return Curry._4(Product_Parser.Matching.MarketPrice.make, param.dealingDate, param.higher, param.mean, param.lower);
                      })), representativeWeight), Curry._2(Product_Parser.Matching.Chart.Payload.make, Belt_Array.map(weeklyMarketPrices.medium, (function (param) {
                        return Curry._4(Product_Parser.Matching.MarketPrice.make, param.dealingDate, param.higher, param.mean, param.lower);
                      })), representativeWeight), Curry._2(Product_Parser.Matching.Chart.Payload.make, Belt_Array.map(weeklyMarketPrices.low, (function (param) {
                        return Curry._4(Product_Parser.Matching.MarketPrice.make, param.dealingDate, param.higher, param.mean, param.lower);
                      })), representativeWeight));
}

var Data = {
  use: use$1
};

function use$2(chart) {
  var user = Curry._1(CustomHooks.User.Buyer.use2, undefined);
  if (typeof user === "number") {
    if (user !== 0) {
      return /* Unauthorized */1;
    } else {
      return /* Unknown */0;
    }
  } else if (chart !== undefined) {
    return /* Ok */{
            _0: chart
          };
  } else {
    return /* Empty */2;
  }
}

var Status = {
  use: use$2
};

var ChartHook = {
  Data: Data,
  Status: Status
};

function PDP_Matching_Demeter_Buyer(props) {
  var selectedGroup = props.selectedGroup;
  var query = props.query;
  var router = Router.useRouter();
  var chartGroup = use$1(query);
  var match = use(query);
  var selectedChart = chartGroup !== undefined ? (
      selectedGroup === "high" ? chartGroup.high : (
          selectedGroup === "medium" ? chartGroup.medium : (
              selectedGroup === "low" ? chartGroup.low : undefined
            )
        )
    ) : undefined;
  var data = use$2(selectedChart);
  if (typeof data === "number") {
    switch (data) {
      case /* Unknown */0 :
          return React$1.createElement("div", {
                      className: "w-full pt-[113%] relative"
                    }, React$1.createElement("img", {
                          className: "w-full h-full object-contain absolute top-0 left-0",
                          src: "/images/chart_placeholder.png"
                        }));
      case /* Unauthorized */1 :
          return React$1.createElement("div", {
                      className: "w-full pt-[113%] relative"
                    }, React$1.createElement("img", {
                          className: "w-full h-full object-contain absolute top-0 left-0",
                          src: "/images/chart_placeholder.png"
                        }), React$1.createElement("div", {
                          className: "absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center"
                        }, React$1.createElement("div", {
                              className: "text-center mb-4"
                            }, ReactNl2br("회원 로그인 후\n전국 도매시장 주간 시세를 확인해보세요")), React$1.createElement(Link, {
                              href: "/buyer/signin?redirect=" + router.asPath + "",
                              children: React$1.createElement("a", undefined, React$1.createElement("span", {
                                        className: "mt-2 px-3 py-2 rounded-xl border border-primary text-primary"
                                      }, "로그인하고 시세 확인하기"))
                            })));
      case /* Empty */2 :
          return React$1.createElement("div", {
                      className: "w-full h-[112px] flex flex-col items-center justify-center"
                    }, React$1.createElement("img", {
                          className: "w-6 h-6 object-contain",
                          src: placeholderIcon
                        }), React$1.createElement("span", {
                          className: "mt-3 text-gray-600 text-[13px]"
                        }, "아직 시세 정보가 없습니다."));
      
    }
  } else {
    var data$1 = data._0;
    var chartId = "pdp-demeter-chart-" + String(match.number) + "-" + selectedGroup + "";
    var graphOption = Curry._1(Product_Parser.Matching.Chart.Graph.make, data$1);
    var tableData = Curry._1(Product_Parser.Matching.Chart.Table.make, data$1);
    return React$1.createElement(React$1.Fragment, undefined, React.createElementWithKey(Echarts.make, {
                    id: chartId,
                    option: graphOption,
                    className: "w-full h-[400px] px-3"
                  }, chartId), React$1.createElement("div", undefined, React$1.createElement("div", {
                        className: "px-5 grid grid-rows-4 grid-flow-col mb-2"
                      }, React$1.createElement("div", {
                            className: "grid grid-cols-4 grid-flow-row pb-1 border-b"
                          }, React$1.createElement("div", {
                                className: "col-start-3 text-right"
                              }, "주간 최고"), React$1.createElement("div", {
                                className: "col-start-4 text-right"
                              }, "주간 최저")), React$1.createElement("div", {
                            className: "grid grid-cols-4 grid-flow-row py-2"
                          }, React$1.createElement("div", {
                                className: "text-left inline-flex items-center"
                              }, React$1.createElement("div", {
                                    className: "w-2 h-2 rounded-full bg-orange-500 mr-1"
                                  }), "최대가"), React$1.createElement("div", {
                                className: "col-start-3 text-right"
                              }, React$1.createElement("span", {
                                    className: "font-bold"
                                  }, "" + Locale.Float.show(undefined, tableData.higherMax, 0) + "원")), React$1.createElement("div", {
                                className: "col-start-4 text-right"
                              }, React$1.createElement("span", {
                                    className: "font-bold"
                                  }, "" + Locale.Float.show(undefined, tableData.higherMin, 0) + "원"))), React$1.createElement("div", {
                            className: "grid grid-cols-4 grid-flow-row py-2"
                          }, React$1.createElement("div", {
                                className: "text-left inline-flex items-center"
                              }, React$1.createElement("div", {
                                    className: "w-2 h-2 rounded-full bg-green-500 mr-1"
                                  }), "평균가"), React$1.createElement("div", {
                                className: "col-start-3 text-right"
                              }, React$1.createElement("span", {
                                    className: "font-bold"
                                  }, "" + Locale.Float.show(undefined, tableData.meanMax, 0) + "원")), React$1.createElement("div", {
                                className: "col-start-4 text-right"
                              }, React$1.createElement("span", {
                                    className: "font-bold"
                                  }, "" + Locale.Float.show(undefined, tableData.meanMin, 0) + "원"))), React$1.createElement("div", {
                            className: "grid grid-cols-4 grid-flow-row py-2"
                          }, React$1.createElement("div", {
                                className: "text-left inline-flex items-center"
                              }, React$1.createElement("div", {
                                    className: "w-2 h-2 rounded-full bg-blue-500 mr-1"
                                  }), "최소가"), React$1.createElement("div", {
                                className: "col-start-3 text-right"
                              }, React$1.createElement("span", {
                                    className: "font-bold"
                                  }, "" + Locale.Float.show(undefined, tableData.lowerMax, 0) + "원")), React$1.createElement("div", {
                                className: "col-start-4 text-right"
                              }, React$1.createElement("span", {
                                    className: "font-bold"
                                  }, "" + Locale.Float.show(undefined, tableData.lowerMin, 0) + "원")))), React$1.createElement("div", {
                        className: "text-right text-xs text-gray-500 px-5"
                      }, ReactNl2br("농림수산부식품교육문화정보원\n전국 도매시장 평균 거래가"))));
  }
}

var make = PDP_Matching_Demeter_Buyer;

export {
  placeholderIcon ,
  Fragment ,
  ChartHook ,
  make ,
}
/* placeholderIcon Not a pure module */
