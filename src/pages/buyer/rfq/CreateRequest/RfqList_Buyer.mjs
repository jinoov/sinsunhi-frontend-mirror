// Generated by ReScript, PLEASE EDIT WITH CARE

import * as $$Intl from "../../../../bindings/intl.mjs";
import * as Curry from "rescript/lib/es6/curry.js";
import * as React from "react";
import * as DS_Icon from "../../../../components/svgs/DS_Icon.mjs";
import * as DataGtm from "../../../../utils/DataGtm.mjs";
import * as DS_Title from "../../../../components/common/container/DS_Title.mjs";
import * as DS_Toast from "../../../../components/common/container/DS_Toast.mjs";
import * as Js_array from "rescript/lib/es6/js_array.js";
import * as DS_Button from "../../../../components/common/element/DS_Button.mjs";
import * as DS_Dialog from "../../../../components/common/container/DS_Dialog.mjs";
import * as RfqCommon from "./RfqCommon.mjs";
import * as Belt_Array from "rescript/lib/es6/belt_Array.js";
import * as Belt_Float from "rescript/lib/es6/belt_Float.js";
import * as Belt_Option from "rescript/lib/es6/belt_Option.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as DS_ListItem from "../../../../components/common/container/DS_ListItem.mjs";
import * as Router from "next/router";
import * as DS_TitleList from "../../../../components/common/element/DS_TitleList.mjs";
import * as Garter_Array from "@greenlabs/garter/src/Garter_Array.mjs";
import * as Authorization from "../../../../utils/Authorization.mjs";
import * as RfqBasket_Buyer from "./RfqBasket_Buyer.mjs";
import * as DS_TopNavigation from "../../../../components/common/container/DS_TopNavigation.mjs";
import * as DS_ButtonContainer from "../../../../components/common/container/DS_ButtonContainer.mjs";
import * as RfqApply_Steps_Buyer from "./RfqApply_Steps_Buyer.mjs";
import * as ReactToastNotifications from "react-toast-notifications";

function displayStorageMethod(v) {
  if (v === "CHILLED") {
    return "냉장";
  } else if (v === "FROZEN") {
    return "냉동";
  } else if (v === "ANY") {
    return "모두";
  } else if (v === "FREEZE_DRIED") {
    return "동결";
  } else if (v === "OTHER") {
    return "그 외";
  } else {
    return "";
  }
}

function displayPackageMethod(v) {
  if (v === "SPLIT") {
    return "소분";
  } else if (v === "ANY") {
    return "모두";
  } else if (v === "CUT") {
    return "세절";
  } else if (v === "RAW") {
    return "원료육(박스육)";
  } else if (v === "OTHER") {
    return "그 외";
  } else {
    return "";
  }
}

function convertToString(v) {
  return RfqApply_Steps_Buyer.ApplySteps.toString(v);
}

function numberToComma(n) {
  return Belt_Option.mapWithDefault(Belt_Float.fromString(n), "", (function (x) {
                return $$Intl.Currency.make(x, "ko-KR", undefined, undefined, undefined);
              }));
}

function RfqList_Buyer$List$Item(props) {
  return React.createElement(DS_ListItem.Normal1.Item.make, {
              children: null
            }, React.createElement(DS_TitleList.Left.TitleSubtitle1.make, {
                  title1: props.title,
                  titleStyle: "font-normal text-text-L2"
                }), React.createElement(DS_ListItem.Normal1.RightGroup.make, {
                  children: React.createElement(DS_TitleList.Common.TextIcon1.Root.make, {
                        children: null,
                        onClick: props.onClick
                      }, Belt_Option.mapWithDefault(props.value, null, (function (value$p) {
                              return React.createElement(DS_TitleList.Common.TextIcon1.$$Text.make, {
                                          children: value$p,
                                          className: "text-right word-keep-all"
                                        });
                            })), React.createElement(DS_TitleList.Common.TextIcon1.Icon.make, {
                            children: React.createElement(DS_Icon.Common.ArrowRightLarge1.make, {
                                  height: "24",
                                  width: "24",
                                  fill: "#999999"
                                })
                          }))
                }));
}

var Item = {
  make: RfqList_Buyer$List$Item
};

function checkValidItemsMeat(item) {
  var isValidPackageMethod = RfqApply_Steps_Buyer.PackageMethod.checkValidPackageMethod(item.packageMethod);
  var isValidGrade = RfqApply_Steps_Buyer.Grade.checkValidGrade(item.grade);
  var isValidWeightKg = RfqApply_Steps_Buyer.OrderAmount.checkValidOrderAmount(item.weightKg);
  var isValidStorageMethod = RfqApply_Steps_Buyer.StorageMethod.checkValidStorageMethod(item.storageMethod);
  var isValidPrice = RfqApply_Steps_Buyer.SupplyPrice.checkValidSupplyPrice(Belt_Option.flatMap(item.prevTradePricePerKg, (function (x) {
              return String(x);
            })));
  var isValidStatus = item.status === "REVIEW_REQUIRED";
  if (isValidPackageMethod && isValidGrade && isValidWeightKg && isValidStorageMethod && isValidPrice && isValidStatus) {
    return true;
  } else {
    return false;
  }
}

function getItemCountInfo(items) {
  var count = items.length;
  var readyCount = Belt_Array.keep(items, checkValidItemsMeat).length;
  return [
          readyCount,
          count,
          count !== 0 && count === readyCount
        ];
}

function RfqList_Buyer$List(props) {
  var requestId = props.requestId;
  var router = Router.useRouter();
  var match = ReactToastNotifications.useToasts();
  var addToast = match.addToast;
  var queryData = Curry._5(RfqBasket_Buyer.Query.CurrentRequest.use, {
        requestIds: [requestId]
      }, /* NetworkOnly */3, undefined, undefined, undefined);
  var match$1 = Curry._1(RfqBasket_Buyer.Fragment.RequestItemsMeat.usePagination, queryData.fragmentRefs);
  var data = match$1.data;
  var match$2 = Curry._1(RfqBasket_Buyer.Mutation.DeleteRequestItemsMeat.use, undefined);
  var deleteRequestItemMeat = match$2[0];
  React.useEffect((function () {
          var itemIds = Belt_Array.map(Curry._1(RfqBasket_Buyer.Fragment.RequestItemsMeat.getConnectionNodes, data.rfqRequestItemsMeat), (function (x) {
                  return x.id;
                }));
          DataGtm.push(DataGtm.mergeUserIdUnsafe({
                    event: "view_rfq_livestock_itemlist",
                    request_id: requestId,
                    request_item_ids: itemIds
                  }));
        }), []);
  var arrItem = Curry._1(RfqBasket_Buyer.Fragment.RequestItemsMeat.getConnectionNodes, data.rfqRequestItemsMeat);
  var handleMove = function (itemId) {
    router.push(itemId !== undefined ? "/buyer/rfq/request/draft/apply?itemId=" + itemId + "&requestId=" + requestId + "" : "/buyer/rfq/request/draft/basket?requestId=" + requestId + "");
  };
  var handleMoveDetail = function (itemId, step, param) {
    router.push("/buyer/rfq/request/draft/apply?itemId=" + itemId + "&requestId=" + requestId + "&step=" + RfqApply_Steps_Buyer.ApplySteps.toString(step) + "&isModify=true");
  };
  var match$3 = getItemCountInfo(arrItem);
  return React.createElement(React.Fragment, undefined, React.createElement("div", {
                  className: "relative container max-w-3xl mx-auto min-h-screen sm:shadow-gl pt-11 bg-gray-50"
                }, React.createElement(DS_TopNavigation.Detail.Root.make, {
                      children: React.createElement(DS_TopNavigation.Detail.Left.make, {
                            children: React.createElement("a", {
                                  className: "cursor-pointer",
                                  onClick: (function (param) {
                                      router.push("/buyer/rfq/request/draft/basket?requestId=" + requestId + "&from=list");
                                    })
                                }, React.createElement(DS_Icon.Common.ArrowLeftXLarge1.make, {
                                      height: "32",
                                      width: "32",
                                      className: "relative"
                                    }))
                          }),
                      bgClassName: "bg-gray-50"
                    }), React.createElement("div", undefined, React.createElement(DS_Title.Normal1.Root.make, {
                          children: React.createElement(DS_Title.Normal1.TextGroup.make, {
                                title1: "선택하신 상품의",
                                title2: "견적요청서를 작성해주세요"
                              }),
                          className: "mt-7"
                        }), React.createElement("section", {
                          className: "mt-7"
                        }, React.createElement(DS_ListItem.Normal1.Root.make, {
                              children: React.createElement(DS_ListItem.Normal1.Item.make, {
                                    children: null
                                  }, React.createElement(DS_ListItem.Normal1.TextGroup.make, {
                                        title1: "" + match$3[0] + "개 작성 / " + match$3[1] + "개",
                                        titleStyle: "text-base leading-6 text-enabled-L2"
                                      }), React.createElement(DS_ListItem.Normal1.RightGroup.make, {
                                        children: React.createElement(DS_TitleList.Common.TextIcon1.Root.make, {
                                              children: null
                                            }, React.createElement(DS_TitleList.Common.TextIcon1.$$Text.make, {
                                                  children: "저장됨",
                                                  className: "text-[13px] leading-5 text-enabled-L2"
                                                }), React.createElement(DS_TitleList.Common.TextIcon1.Icon.make, {
                                                  children: React.createElement(DS_Icon.Common.LineCheckedMedium1.make, {
                                                        height: "16",
                                                        width: "16",
                                                        fill: "#999999"
                                                      })
                                                }))
                                      }))
                            }), React.createElement("ul", {
                              className: "flex flex-col items-center space-y-3 mx-5 mt-9"
                            }, Belt_Array.map(arrItem, (function (node) {
                                    var species = node.species;
                                    var part = node.part;
                                    var itemId = node.id;
                                    var isSubmitted = checkValidItemsMeat(node);
                                    var match = Belt_Option.map(node.species, (function (x) {
                                            return x.code;
                                          }));
                                    var match$1 = Belt_Option.map(node.part, (function (x) {
                                            return x.isDomestic;
                                          }));
                                    var isSkipGrade;
                                    if (match !== undefined && match$1 !== undefined) {
                                      switch (match) {
                                        case "CHICKEN" :
                                            isSkipGrade = true;
                                            break;
                                        case "PORK" :
                                            isSkipGrade = match$1 ? false : true;
                                            break;
                                        default:
                                          isSkipGrade = false;
                                      }
                                    } else {
                                      isSkipGrade = false;
                                    }
                                    return React.createElement("li", {
                                                key: itemId,
                                                className: "w-full bg-white rounded-lg py-5"
                                              }, React.createElement("div", {
                                                    className: "tab-highlight-color px-5 flex justify-between items-start"
                                                  }, React.createElement(DS_TitleList.Left.Title3Subtitle1.make, {
                                                        title1: Belt_Option.mapWithDefault(species, "", (function (x) {
                                                                return x.shortName;
                                                              })),
                                                        title2: Belt_Option.mapWithDefault(part, "", (function (x) {
                                                                return x.name;
                                                              })),
                                                        title3: Belt_Option.mapWithDefault(part, "", (function (x) {
                                                                if (x.isDomestic) {
                                                                  return "국내";
                                                                } else {
                                                                  return "수입";
                                                                }
                                                              }))
                                                      }), React.createElement(DS_Dialog.Popup.Root.make, {
                                                        children: null
                                                      }, React.createElement(DS_Dialog.Popup.Trigger.make, {
                                                            children: React.createElement("div", {
                                                                  className: "flex justify-start items-center space-x-1 cursor-pointer"
                                                                }, React.createElement(DS_Icon.Common.DeleteMedium1.make, {
                                                                      height: "16",
                                                                      width: "16",
                                                                      fill: "#727272"
                                                                    }), React.createElement("span", {
                                                                      className: "text-[13px] leading-5 text-enabled-L2 truncate"
                                                                    }, "삭제")),
                                                            asChild: false
                                                          }), React.createElement(DS_Dialog.Popup.Portal.make, {
                                                            children: null
                                                          }, React.createElement(DS_Dialog.Popup.Overlay.make, {}), React.createElement(DS_Dialog.Popup.Content.make, {
                                                                children: null
                                                              }, React.createElement(DS_Dialog.Popup.Title.make, {
                                                                    children: "아래 부위를 삭제할까요?"
                                                                  }), React.createElement(DS_Dialog.Popup.Description.make, {
                                                                    children: "" + Belt_Option.mapWithDefault(species, "", (function (x) {
                                                                            return x.shortName;
                                                                          })) + " / " + Belt_Option.mapWithDefault(part, "", (function (x) {
                                                                            return x.name;
                                                                          })) + " / " + Belt_Option.mapWithDefault(part, "", (function (x) {
                                                                            if (x.isDomestic) {
                                                                              return "국내";
                                                                            } else {
                                                                              return "수입";
                                                                            }
                                                                          })) + ""
                                                                  }), React.createElement(DS_Dialog.Popup.Buttons.make, {
                                                                    children: null
                                                                  }, React.createElement(DS_Dialog.Popup.Close.make, {
                                                                        children: React.createElement(DS_Button.Normal.Large1.make, {
                                                                              label: "아니오",
                                                                              buttonType: "white"
                                                                            }),
                                                                        asChild: true
                                                                      }), React.createElement(DS_Dialog.Popup.Close.make, {
                                                                        children: React.createElement(DS_Button.Normal.Large1.make, {
                                                                              label: "네",
                                                                              onClick: (function (param) {
                                                                                  Curry.app(deleteRequestItemMeat, [
                                                                                        undefined,
                                                                                        (function (param, param$1) {
                                                                                            var variant = param.deleteRfqRequestItemsMeat.NAME;
                                                                                            if (variant === "UnselectedUnionMember" || variant === "Error") {
                                                                                              return addToast(DS_Toast.getToastComponent("요청 중 요류가 발생했습니다. 잠시 후 다시 시도해주세요.", "error"), {
                                                                                                          appearance: "error"
                                                                                                        });
                                                                                            } else {
                                                                                              return addToast(DS_Toast.getToastComponent("삭제되었습니다.", "succ"), {
                                                                                                          appearance: "success"
                                                                                                        });
                                                                                            }
                                                                                          }),
                                                                                        undefined,
                                                                                        undefined,
                                                                                        undefined,
                                                                                        undefined,
                                                                                        {
                                                                                          connections: [data.rfqRequestItemsMeat.__id],
                                                                                          id: itemId
                                                                                        },
                                                                                        undefined,
                                                                                        undefined
                                                                                      ]);
                                                                                })
                                                                            }),
                                                                        asChild: true
                                                                      })))))), isSubmitted ? React.createElement(DS_ListItem.Normal1.Root.make, {
                                                      children: null,
                                                      className: "pt-5 space-y-3.5"
                                                    }, Belt_Option.mapWithDefault(node.packageMethod, null, (function (x) {
                                                            return React.createElement(RfqList_Buyer$List$Item, {
                                                                        title: "포장상태",
                                                                        value: displayPackageMethod(x),
                                                                        onClick: (function (param) {
                                                                            return handleMoveDetail(itemId, /* Package */0, param);
                                                                          })
                                                                      });
                                                          })), isSkipGrade ? null : Belt_Option.mapWithDefault(node.grade, null, (function (x) {
                                                              return React.createElement(React.Fragment, undefined, React.createElement(RfqList_Buyer$List$Item, {
                                                                              title: "등급",
                                                                              value: x.grade,
                                                                              onClick: (function (param) {
                                                                                  return handleMoveDetail(itemId, /* Grade */1, param);
                                                                                })
                                                                            }));
                                                            })), Belt_Option.mapWithDefault(node.weightKg, null, (function (x) {
                                                            return React.createElement(RfqList_Buyer$List$Item, {
                                                                        title: "주문량",
                                                                        value: "" + numberToComma(Garter_Array.firstExn(x.split("."))) + " kg",
                                                                        onClick: (function (param) {
                                                                            return handleMoveDetail(itemId, /* Amount */2, param);
                                                                          })
                                                                      });
                                                          })), Garter_Array.isEmpty(node.usages.edges) ? null : React.createElement(RfqList_Buyer$List$Item, {
                                                            title: "사용용도",
                                                            value: Js_array.joinWith(", ", Belt_Array.map(node.usages.edges, (function (edge) {
                                                                        return edge.node.name;
                                                                      }))),
                                                            onClick: (function (param) {
                                                                return handleMoveDetail(itemId, /* Usage */3, param);
                                                              })
                                                          }), Belt_Option.mapWithDefault(node.storageMethod, null, (function (x) {
                                                            return React.createElement(RfqList_Buyer$List$Item, {
                                                                        title: "보관상태",
                                                                        value: displayStorageMethod(x),
                                                                        onClick: (function (param) {
                                                                            return handleMoveDetail(itemId, /* Storage */4, param);
                                                                          })
                                                                      });
                                                          })), node.prevTradeSellerName === "" ? null : React.createElement(RfqList_Buyer$List$Item, {
                                                            title: "기존공급처",
                                                            value: node.prevTradeSellerName,
                                                            onClick: (function (param) {
                                                                return handleMoveDetail(itemId, /* Price */5, param);
                                                              })
                                                          }), Belt_Option.mapWithDefault(node.prevTradePricePerKg, null, (function (x) {
                                                            return React.createElement(RfqList_Buyer$List$Item, {
                                                                        title: "기존공급가",
                                                                        value: "" + numberToComma(String(x)) + "원/kg",
                                                                        onClick: (function (param) {
                                                                            return handleMoveDetail(itemId, /* Price */5, param);
                                                                          })
                                                                      });
                                                          })), Garter_Array.isEmpty(node.brands.edges) ? React.createElement(RfqList_Buyer$List$Item, {
                                                            title: "브랜드",
                                                            value: "브랜드 무관",
                                                            onClick: (function (param) {
                                                                return handleMoveDetail(itemId, /* Brand */6, param);
                                                              })
                                                          }) : React.createElement(RfqList_Buyer$List$Item, {
                                                            title: "브랜드",
                                                            value: Js_array.joinWith(", ", Belt_Array.map(node.brands.edges, (function (edge) {
                                                                        return edge.node.name;
                                                                      }))),
                                                            onClick: (function (param) {
                                                                return handleMoveDetail(itemId, /* Brand */6, param);
                                                              })
                                                          }), node.otherRequirements === "" ? null : React.createElement(RfqList_Buyer$List$Item, {
                                                            title: "기타 요청사항",
                                                            onClick: (function (param) {
                                                                return handleMoveDetail(itemId, /* Etc */7, param);
                                                              })
                                                          })) : React.createElement("div", {
                                                      className: "px-5 pt-5 flex justify-center cursor-pointer",
                                                      onClick: (function (param) {
                                                          handleMove(itemId);
                                                        })
                                                    }, React.createElement("span", {
                                                          className: "text-primary"
                                                        }, "상세 요청사항 입력하기"), React.createElement(DS_Icon.Common.ArrowRightLarge1.make, {
                                                          height: "24",
                                                          width: "24",
                                                          fill: "#999999"
                                                        })));
                                  }))), React.createElement("button", {
                              className: "w-full py-3 flex justify-center items-center gap-1 leading-6 cursor-pointer mt-4 text-enabled-L2 pb-[104px] tab-highlight-color",
                              onClick: (function (param) {
                                  handleMove(undefined);
                                })
                            }, React.createElement(DS_Icon.Common.PlusSmall1.make, {
                                  height: "12",
                                  width: "12",
                                  fill: "#727272"
                                }), "부위 추가 하기")))), React.createElement(DS_ButtonContainer.Floating1.make, {
                  label: "작성 완료",
                  disabled: !match$3[2],
                  onClick: (function (param) {
                      router.push("/buyer/rfq/request/draft/shipping?requestId=" + requestId + "");
                    })
                }));
}

var List = {
  Item: Item,
  checkValidItemsMeat: checkValidItemsMeat,
  getItemCountInfo: getItemCountInfo,
  make: RfqList_Buyer$List
};

function RfqList_Buyer(props) {
  var requestId = props.requestId;
  var router = Router.useRouter();
  if (requestId !== undefined) {
    return React.createElement(Authorization.Buyer.make, {
                children: React.createElement(React.Suspense, {
                      children: Caml_option.some(React.createElement(RfqCommon.CheckBuyerRequestStatus.make, {
                                children: React.createElement(RfqList_Buyer$List, {
                                      requestId: requestId
                                    }),
                                requestId: requestId
                              })),
                      fallback: Caml_option.some(React.createElement("div", undefined))
                    }),
                title: "바이어 견적 요청",
                fallback: Caml_option.some(null)
              });
  } else {
    React.useEffect((function () {
            router.push("/buyer/rfq");
          }), []);
    return null;
  }
}

var Query;

var Fragment;

var Fragment_type;

var Mutation;

var make = RfqList_Buyer;

export {
  Query ,
  Fragment ,
  Fragment_type ,
  Mutation ,
  displayStorageMethod ,
  displayPackageMethod ,
  convertToString ,
  numberToComma ,
  List ,
  make ,
}
/* react Not a pure module */
