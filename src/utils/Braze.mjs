// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Env from "../constants/Env.mjs";
import * as React from "react";
import * as Js_promise from "rescript/lib/es6/js_promise.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Caml_js_exceptions from "rescript/lib/es6/caml_js_exceptions.js";

function use(param) {
  var match = React.useState(function () {
        
      });
  var setBraze = match[1];
  var braze = match[0];
  React.useEffect((function () {
          var match = window.ReactNativeWebView;
          if (match == null) {
            try {
              Js_promise.$$catch((function (err) {
                      console.log("braze init error: ", err);
                      return Promise.resolve(undefined);
                    }), Js_promise.then_((function (sdk) {
                          setBraze(function (param) {
                                if (sdk == null) {
                                  return ;
                                } else {
                                  return Caml_option.some(sdk);
                                }
                              });
                          return Promise.resolve(undefined);
                        }), import("@braze/web-sdk")));
            }
            catch (raw_err){
              var err = Caml_js_exceptions.internalToOCamlException(raw_err);
              console.log("fail to initize braze: ", err);
            }
          }
          
        }), []);
  React.useEffect((function () {
          var match = window.ReactNativeWebView;
          if (match == null) {
            try {
              Js_promise.$$catch((function (err) {
                      console.log("Failed to register service worker : ", err);
                      return Promise.resolve(undefined);
                    }), Js_promise.then_((function (param) {
                          if (braze !== undefined) {
                            braze.openSession();
                          }
                          return Promise.resolve(undefined);
                        }), window.navigator.serviceWorker.register("/service-worker.js")));
            }
            catch (raw_err){
              var err = Caml_js_exceptions.internalToOCamlException(raw_err);
              console.log("fail to initize braze: ", err);
              Promise.resolve(undefined);
            }
            if (braze !== undefined) {
              braze.initialize(Env.brazeWebApiKey, {
                    baseUrl: "sdk.iad-06.braze.com",
                    enableLogging: false,
                    manageServiceWorkerExternally: true,
                    safariWebsitePushId: "web.com.sinsunhi.app"
                  });
            }
            
          }
          
        }), [braze]);
  return braze;
}

function changeUser(user, braze) {
  var match = user.role;
  if (match >= 2) {
    return ;
  } else if (Env.vercelEnv === "production") {
    return braze.changeUser(String(user.id));
  } else {
    return braze.changeUser("" + String(user.id) + "-dev");
  }
}

export {
  use ,
  changeUser ,
}
/* Env Not a pure module */
